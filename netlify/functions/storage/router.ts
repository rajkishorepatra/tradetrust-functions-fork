import express, { Request, Response } from "express";
import { checkApiKey } from "../../utils";
import {
  uploadDocument,
  uploadDocumentAtId,
  getQueueNumber,
  getDocument,
} from "./helpers";
// import { decryptString } from "@govtechsg/oa-encryption";
const { decryptString } = require("@govtechsg/oa-encryption");
const router = express.Router();

router.post("/", checkApiKey, async (req: Request, res: Response) => {
  const {
    body: { document },
  } = req;

  try {
    const result = await uploadDocument(document);
    res.status(200).json(result);
  } catch (err) {
    res.status(400).json(err);
  }
});

router.post("/:id", checkApiKey, async (req: Request, res: Response) => {
  const {
    body: { document },
    params: { id },
  } = req;

  try {
    const result = await uploadDocumentAtId(document, id);
    res.status(200).json(result);
  } catch (err) {
    res.status(400).json(err);
  }
});

router.get("/queue", checkApiKey, async (req: Request, res: Response) => {
  try {
    const result = await getQueueNumber();
    res.status(200).json(result);
  } catch (err) {
    res.status(400).json(err);
  }
});

// lets omit checkApiKey for tradetrust web to retrieve document easily
router.get("/:id", async (req: Request, res: Response) => {
  const {
    params: { id },
  } = req;

  try {
    const { document } = await getDocument(id);
    console.log(document)
    // const { decryptString } = require("@govtechsg/oa-encryption");

const encryptedDocument = {
  cipherText: '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',
  iv: 'V9b4Dp9UdGSrYVvR',
  tag: 'pHVfd5McX5EzZQlTPHRbjA==',
  type: 'OPEN-ATTESTATION-TYPE-1'
};
const decryptedDocument = decryptString(encryptedDocument);
console.log(JSON.parse(decryptedDocument));
    res.status(200).json(document);
  } catch (err) {
    console.log(err)
    res.status(400).json(err);
  }
});

export { router };
